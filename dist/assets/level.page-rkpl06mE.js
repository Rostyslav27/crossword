import{d as D,r as _,c as J,a as h,e as g,f as H,w as R,i as ee,v as te,F as T,b as U,j as k,g as le,o as f,k as ae,n as oe,u as Q,t as I,l as S,_ as re,m as ne,p as se}from"./index-BB2A3vI3.js";import{l as ie}from"./levels-WIb7_k_b.js";const ve={class:"level"},ue={class:"level__header"},de={class:"level__main"},ce={class:"level__questions"},he=["viewBox"],fe=["x","y","width","height"],xe=["transform","onClick"],pe=["fill"],_e=["y"],me=["x","y"],i=10,We=D({__name:"Level",props:{level:{}},setup(V){var L,O;const u=V,x=i/30,d=x*1.4,C=i/2,$=i*.65,G=i*.3,b=_(i*Math.max(...u.level.words.map(e=>e.vertical?e.xStart+1:e.word.length+e.xStart))||i),A=_(i*Math.max(...u.level.words.map(e=>e.vertical?e.word.length+e.yStart:e.yStart+1))||i),w=_({completed:0,answers:{}}),K=((O=(L=u.level.words.map((e,a)=>[a,e.question.length]).sort((e,a)=>a[1]-e[1]))==null?void 0:L[0])==null?void 0:O[0])||0;w.value=JSON.parse(localStorage.getItem("answers"+u.level.id)||'{ "completed": 0, "answers": {} }')||{completed:0,answers:{}};const l=J(()=>{const e={};for(let a=0;a<u.level.words.length;a++){const o=u.level.words[a];o.word=o.word.toUpperCase();for(let t=0;t<o.word.length;t++){const W=i*(o.xStart+t*+!o.vertical),v=i*(o.yStart+t*+o.vertical),s=W+"-"+v;e[s]||(e[s]={id:s,x:W,y:v,currentValue:w.value.answers[s]||"",correctValue:o.word[t]}),t||(e[s].wordIndex=o.index),o.vertical?e[s].verticalWord={wordIndex:a,letterIndex:t}:e[s].horizontalWord={wordIndex:a,letterIndex:t}}}return e}),p=J(()=>{const e=[],a=Object.values(l.value);for(let o=0;o<a.length;o++){const t=a[o];t.horizontalWord&&(e[t.horizontalWord.wordIndex]||(e[t.horizontalWord.wordIndex]=[]),e[t.horizontalWord.wordIndex][t.horizontalWord.letterIndex]=t),t.verticalWord&&(e[t.verticalWord.wordIndex]||(e[t.verticalWord.wordIndex]=[]),e[t.verticalWord.wordIndex][t.verticalWord.letterIndex]=t)}return e}),m=_([]),M=_({}),P=e=>{m.value[e]=!p.value[e].some(a=>a.correctValue!=a.currentValue),m.value[e]&&p.value[e].forEach(a=>{M.value[a.id]=!0})},N=()=>{for(let e=0;e<p.value.length;e++)P(e);w.value.completed=Math.ceil(m.value.filter(e=>e).length/m.value.length*100),localStorage.setItem("answers"+u.level.id,JSON.stringify(w.value))};N();const n=_(""),r=_(-1),c=_("-"),q=_(null),y=e=>{var a,o;if(l.value[e]){const t=()=>{var v,s,F;if(n.value===e){let j=r.value;[l.value[e].horizontalWord,l.value[e].verticalWord].forEach(z=>{z&&z.wordIndex!==r.value&&(j=z.wordIndex)}),r.value=j}else l.value[e].verticalWord&&l.value[e].horizontalWord&&[(v=l.value[e].verticalWord)==null?void 0:v.wordIndex,(s=l.value[e].horizontalWord)==null?void 0:s.wordIndex].includes(r.value)||(r.value=((F=l.value[e].horizontalWord||l.value[e].verticalWord)==null?void 0:F.wordIndex)||0)};if([l.value[e].horizontalWord,l.value[e].verticalWord].some(v=>v&&m.value[v.wordIndex])&&l.value[e].verticalWord&&l.value[e].horizontalWord){let v=r.value;[l.value[e].horizontalWord,l.value[e].verticalWord].forEach(s=>{s&&!m.value[s.wordIndex]&&(v=s.wordIndex)}),v!=r.value?r.value=v:t()}else l.value[e].verticalWord&&l.value[e].horizontalWord&&r.value>-1&&n.value?t():r.value=((a=l.value[e].horizontalWord||l.value[e].verticalWord)==null?void 0:a.wordIndex)||0;(o=q.value)==null||o.focus({preventScroll:!0})}else r.value=-1;n.value=e},E=e=>{M.value[n.value]?S().then(()=>{B()}):(l.value[n.value].currentValue=e,w.value.answers[n.value]=e,localStorage.setItem("answers"+u.level.id,JSON.stringify(w.value)),N(),e?S().then(()=>{B()}):S().then(()=>{Y()}))},X=()=>{n.value&&l.value[n.value]&&(c.value.length&&c.value!="-"?(c.value=c.value[c.value.length-1],E(c.value[c.value.length-1].toUpperCase())):(c.value="-",E("")))},B=()=>{p.value[r.value]&&[l.value[n.value].horizontalWord,l.value[n.value].verticalWord].forEach(e=>{e&&e.wordIndex===r.value&&p.value[r.value][e.letterIndex+1]&&y(p.value[r.value][e.letterIndex+1].id)})},Y=()=>{p.value[r.value]&&[l.value[n.value].horizontalWord,l.value[n.value].verticalWord].forEach(e=>{e&&e.wordIndex===r.value&&p.value[r.value][e.letterIndex-1]&&y(p.value[r.value][e.letterIndex-1].id)})},Z=e=>{var a,o;return e.horizontalWord&&m.value[e.horizontalWord.wordIndex]||e.verticalWord&&m.value[e.verticalWord.wordIndex]?"#fff9c3":n.value===e.id?"#55ff82":[(a=e.horizontalWord)==null?void 0:a.wordIndex,(o=e.verticalWord)==null?void 0:o.wordIndex].includes(r.value)?"#c8fec6":"#fff"};return(e,a)=>{const o=le("RouterLink");return f(),h("div",ve,[g("div",ue,[H(o,{class:"level__back",to:"/"},{default:R(()=>[ae("Назад")]),_:1})]),ee(g("input",{class:"level__input",type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),onInput:X,ref_key:"activeCellInput",ref:q},null,544),[[te,c.value]]),g("div",de,[g("div",ce,[(f(!0),h(T,null,U(e.level.words,(t,W)=>(f(),h("p",{class:oe(["level__question",{"level__question--space":W===Q(K),"level__question--active":r.value===W}])},I(t.question),3))),256))]),(f(),h("svg",{class:"level__field",viewBox:`-${x} -${x} ${b.value+d*2} ${A.value+d*2}`},[g("rect",{x:"-"+x,y:"-"+x,width:b.value+d*2,height:A.value+d*2,fill:"#bdbdbd",onClick:a[1]||(a[1]=t=>y(""))},null,8,fe),(f(!0),h(T,null,U(l.value,t=>(f(),h("g",{transform:`translate(${t.x} ${t.y})`,onClick:W=>y(t.id)},[g("rect",{x:"0",y:"0",width:i,height:i,"stroke-width":x,stroke:"#000",fill:Z(t)},null,8,pe),t.currentValue?(f(),h("text",{key:0,x:C,y:C+x,"font-size":$,"dominant-baseline":"middle","text-anchor":"middle","font-family":"Arial"},I(t.currentValue),9,_e)):k("",!0),t.wordIndex?(f(),h("text",{key:1,x:d,y:d,"font-size":G,"dominant-baseline":"hanging","text-anchor":"start","font-family":"Arial"},I(t.wordIndex),1)):k("",!0)],8,xe))),256)),l.value[n.value]?(f(),h("rect",{key:0,x:l.value[n.value].x,y:l.value[n.value].y,width:i,height:i,"stroke-width":d,stroke:"#000",fill:"none",onClick:a[2]||(a[2]=t=>y(n.value))},null,8,me)):k("",!0)],8,he))])])}}}),we=re(We,[["__scopeId","data-v-cbd284d4"]]),ge={class:"level-page"},ze=D({__name:"level.page",setup(V){const u=ne(),x=se();let d={id:1,name:"test",words:[]};return u.params.levelid?d=ie.find(C=>String(C.id)===u.params.levelid)||d:x.push("/"),(C,$)=>(f(),h("div",ge,[H(we,{level:Q(d)},null,8,["level"])]))}});export{ze as default};
